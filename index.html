<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tr·ª£ L√Ω BHYT 6.9 (Pro Calc)</title>
    
    <style>
        #error-console { display: none; position: fixed; top: 0; left: 0; width: 100%; background: #fee2e2; color: #b91c1c; padding: 10px; z-index: 9999; font-size: 12px; border-bottom: 2px solid #ef4444; }
        .mobile-tap { cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent; }
    </style>
    <script>
        window.onerror = function(msg, url, line) {
            var consoleDiv = document.getElementById('error-console');
            consoleDiv.style.display = 'block';
            consoleDiv.innerHTML += "<div>‚ö†Ô∏è " + msg + " (Line: " + line + ")</div>";
            return false;
        };
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        body { background-color: #f0f4f8; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Range Slider Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #2563eb; cursor: pointer; margin-top: -8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #cbd5e1; border-radius: 2px; }
        
        /* Markdown Styling */
        .markdown-content { color: #1e293b; line-height: 1.7; font-size: 0.95rem; }
        .markdown-content h1 { color: #1e3a8a; font-weight: 800; font-size: 1.6em; margin-top: 1.2em; margin-bottom: 0.8em; border-bottom: 2px solid #bfdbfe; }
        .markdown-content h2 { color: #2563eb; font-weight: 700; font-size: 1.3em; margin-top: 1.5em; background: #eff6ff; padding: 8px 12px; border-left: 4px solid #3b82f6; border-radius: 0 8px 8px 0; }
        .markdown-content strong { color: #0f172a; font-weight: 700; background-color: #fef9c3; padding: 0 4px; }
        .markdown-content table { width: 100%; border-collapse: separate; margin: 1.5em 0; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); font-size: 0.9em; border: 1px solid #e2e8f0; }
        .markdown-content th { background: linear-gradient(to right, #2563eb, #1d4ed8); color: white; padding: 14px; text-align: left; }
        .markdown-content td { padding: 12px 14px; border-bottom: 1px solid #e2e8f0; background-color: white; }
        .markdown-content tr:nth-child(even) td { background-color: #f8fafc; }
    </style>
</head>
<body>
    <div id="error-console"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- H·ªÜ TH·ªêNG ICON SVG ---
        const Icons = {
            Shield: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            FileText: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
            Upload: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Search: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            Calc: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="12" y1="6" x2="12" y2="6"/><line x1="16" y1="6" x2="16" y2="6"/><line x1="8" y1="6" x2="8" y2="6"/><line x1="12" y1="10" x2="12" y2="10"/><line x1="16" y1="10" x2="16" y2="10"/><line x1="8" y1="10" x2="8" y2="10"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="8" y1="18" x2="8" y2="18"/></svg>,
            Send: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Robot: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></svg>,
            Chat: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Copy: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Money: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Lock: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        };

        // --- KEY API (Thay b·∫±ng key c·ªßa b·∫°n n·∫øu key n√†y h·∫øt h·∫°n) ---
        const EMBEDDED_API_KEY = "AIzaSyAOOahesQOsyhzdYSnsuL5QG4MHO2BUgRg"; 

        // --- H√ÄM ƒê·ªäNH D·∫†NG TI·ªÄN T·ªÜ ---
        const formatVND = (amount) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);

        // --- COMPONENT T√çNH BHXH T·ª∞ NGUY·ªÜN (M·ªöI) ---
        const BHXHCalculator = () => {
            const [income, setIncome] = useState(1500000); // M·∫∑c ƒë·ªãnh chu·∫©n ngh√®o
            const [group, setGroup] = useState('other'); // 'other', 'poor', 'ethnic'
            
            const MIN_SALARY = 1500000;
            const BASE_SALARY = 2340000;
            const MAX_SALARY = BASE_SALARY * 20; // 46.800.000
            
            // M·ª©c h·ªó tr·ª£ (Theo y√™u c·∫ßu ng∆∞·ªùi d√πng)
            const SUPPORT_RATES = {
                poor: 165000,    // H·ªô ngh√®o (50%)
                ethnic: 99000,   // D√¢n t·ªôc (30%)
                other: 66000     // ƒê·ªëi t∆∞·ª£ng kh√°c
            };

            const rateBHXH = 0.22; // 22%
            
            // X·ª≠ l√Ω thay ƒë·ªïi thu nh·∫≠p
            const handleIncomeChange = (e) => {
                let val = parseInt(e.target.value);
                if (val > MAX_SALARY) val = MAX_SALARY;
                setIncome(val);
            };

            const monthlyFeeRaw = income * rateBHXH;
            const monthlySupport = SUPPORT_RATES[group];
            const monthlyFinal = monthlyFeeRaw - monthlySupport;

            // T√≠nh b·∫£ng chi ti·∫øt
            const periods = [1, 3, 6, 12];

            return (
                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 text-white">
                        <h3 className="font-bold text-lg flex items-center gap-2"><Icons.Calc/> T√≠nh M·ª©c ƒê√≥ng BHXH T·ª± Nguy·ªán</h3>
                        <p className="text-blue-100 text-xs mt-1">C·∫≠p nh·∫≠t ch√≠nh x√°c theo m·ª©c h·ªó tr·ª£ m·ªõi nh·∫•t</p>
                    </div>
                    
                    <div className="p-6 space-y-6">
                        {/* 1. Ch·ªçn ƒë·ªëi t∆∞·ª£ng */}
                        <div>
                            <label className="block text-sm font-bold text-slate-700 mb-2">B·∫°n thu·ªôc ƒë·ªëi t∆∞·ª£ng n√†o?</label>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                {[
                                    { id: 'other', label: 'ƒê·ªëi t∆∞·ª£ng kh√°c', sub: 'H·ªó tr·ª£ 66.000ƒë' },
                                    { id: 'ethnic', label: 'D√¢n t·ªôc / C·∫≠n ngh√®o', sub: 'H·ªó tr·ª£ 99.000ƒë' },
                                    { id: 'poor', label: 'H·ªô ngh√®o', sub: 'H·ªó tr·ª£ 165.000ƒë' }
                                ].map(item => (
                                    <button key={item.id} onClick={() => setGroup(item.id)}
                                        className={`p-3 rounded-xl border text-left transition-all ${group === item.id ? 'border-blue-500 bg-blue-50 ring-1 ring-blue-500' : 'border-slate-200 hover:border-blue-300'}`}>
                                        <div className={`font-bold ${group === item.id ? 'text-blue-700' : 'text-slate-700'}`}>{item.label}</div>
                                        <div className="text-xs text-slate-500">{item.sub}</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* 2. Ch·ªçn m·ª©c thu nh·∫≠p */}
                        <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <label className="block text-sm font-bold text-slate-700 mb-1">M·ª©c thu nh·∫≠p ch·ªçn ƒë√≥ng (VNƒê)</label>
                            <div className="text-xs text-slate-500 mb-4">Th·∫•p nh·∫•t: 1.500.000ƒë - Cao nh·∫•t: {formatVND(MAX_SALARY)}</div>
                            
                            <div className="flex items-center gap-4 mb-4">
                                <input type="number" 
                                    value={income} 
                                    onChange={handleIncomeChange}
                                    className="flex-1 p-3 border border-slate-300 rounded-lg font-bold text-blue-700 text-lg outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <span className="font-bold text-slate-400">VNƒê</span>
                            </div>
                            
                            <input type="range" min={MIN_SALARY} max={MAX_SALARY} step={50000} value={income} onChange={handleIncomeChange} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" />
                        </div>

                        {/* 3. K·∫øt qu·∫£ t√≠nh to√°n */}
                        <div className="bg-green-50 rounded-xl border border-green-200 p-5">
                             <div className="flex justify-between items-end border-b border-green-200 pb-3 mb-3">
                                <span className="text-green-800 font-medium">M·ª©c ƒë√≥ng 1 th√°ng (sau h·ªó tr·ª£):</span>
                                <span className="text-2xl font-extrabold text-green-700">{formatVND(monthlyFinal)}</span>
                            </div>
                            <div className="text-xs text-green-700 space-y-1">
                                <div className="flex justify-between"><span>ƒê√≥ng theo lu·∫≠t (22%):</span> <span>{formatVND(monthlyFeeRaw)}</span></div>
                                <div className="flex justify-between font-bold"><span>Nh√† n∆∞·ªõc h·ªó tr·ª£ (-):</span> <span>{formatVND(monthlySupport)}</span></div>
                            </div>
                        </div>

                        {/* 4. B·∫£ng Tra C·ª©u Nhanh */}
                        <div>
                            <h4 className="font-bold text-slate-800 mb-3 flex items-center gap-2"><Icons.Money/> B·∫£ng Tra C·ª©u S·ªë Ti·ªÅn Ph·∫£i ƒê√≥ng</h4>
                            <div className="overflow-hidden rounded-xl border border-slate-200">
                                <table className="w-full text-sm">
                                    <thead className="bg-slate-100 text-slate-600">
                                        <tr>
                                            <th className="p-3 text-left">Ph∆∞∆°ng th·ª©c</th>
                                            <th className="p-3 text-right">T·ªïng ti·ªÅn ƒë√≥ng</th>
                                            <th className="p-3 text-right text-xs text-slate-400 hidden sm:table-cell">Ti·∫øt ki·ªám (H·ªó tr·ª£)</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {periods.map(m => (
                                            <tr key={m} className="hover:bg-slate-50">
                                                <td className="p-3 font-medium text-slate-700">ƒê√≥ng {m} th√°ng</td>
                                                <td className="p-3 text-right font-bold text-blue-600 text-base">{formatVND(monthlyFinal * m)}</td>
                                                <td className="p-3 text-right text-green-600 font-medium hidden sm:table-cell">{formatVND(monthlySupport * m)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                             <p className="text-xs text-slate-400 mt-2 italic">* M·ª©c ƒë√≥ng ƒë√£ ƒë∆∞·ª£c tr·ª´ ƒëi ph·∫ßn h·ªó tr·ª£ c·ªßa nh√† n∆∞·ªõc.</p>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const isKeyValid = (key) => key && key.length > 30 && !key.includes("D√ÅN_KEY");
            const hasEmbeddedKey = isKeyValid(EMBEDDED_API_KEY);
            const [apiKey, setApiKey] = useState(hasEmbeddedKey ? EMBEDDED_API_KEY.trim() : (localStorage.getItem('gemini_api_key') || ''));
            const [isKeySet, setIsKeySet] = useState(hasEmbeddedKey || !!localStorage.getItem('gemini_api_key'));
            const [activeTab, setActiveTab] = useState('calculate');
            
            // --- C√ÅC STATE C≈® ---
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState('');
            const [chatHistory, setChatHistory] = useState([{ role: 'model', text: 'Xin ch√†o! T√¥i l√† Tr·ª£ l√Ω AI chuy√™n v·ªÅ BHYT & BHXH. T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?' }]);
            const [chatInput, setChatInput] = useState('');
            const chatContainerRef = useRef(null);
            const [summaryText, setSummaryText] = useState('');
            const [pdfFile, setPdfFile] = useState(null);
            const [term, setTerm] = useState('');
            const [mediaData, setMediaData] = useState({ target: 'Sinh vi√™n', type: 'BHYT H·ªô gia ƒë√¨nh' });

            useEffect(() => {
                if (window.pdfjsLib) {
                    try { window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'; } catch(e) {}
                }
            }, []);

            useEffect(() => {
                if (chatContainerRef.current) chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
            }, [chatHistory, activeTab]);

            const handleSaveKey = () => {
                if (apiKey.trim().length > 10) {
                    localStorage.setItem('gemini_api_key', apiKey.trim());
                    setIsKeySet(true);
                }
            };
            
            const handleResetKey = () => {
                if (hasEmbeddedKey) return alert("H·ªá th·ªëng ƒëang d√πng Key t√≠ch h·ª£p s·∫µn.");
                localStorage.removeItem('gemini_api_key');
                setApiKey('');
                setIsKeySet(false);
            };

            const extractTextFromPDF = async (file) => {
                if (!window.pdfjsLib) throw new Error("L·ªói th∆∞ vi·ªán PDF.");
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let fullText = "";
                const maxPages = pdf.numPages > 20 ? 20 : pdf.numPages;
                for (let i = 1; i <= maxPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    fullText += `\n ` + textContent.items.map(item => item.str).join(' ');
                }
                return fullText;
            };

            const generateContent = async (prompt) => {
                setLoading(true); setResult('');
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);
                    setResult(data.candidates[0].content.parts[0].text);
                } catch (error) { setResult(`‚ö†Ô∏è L·ªói: ${error.message}`); } 
                finally { setLoading(false); }
            };

            const sendChat = async () => {
                if (!chatInput.trim()) return;
                const userMsg = { role: 'user', text: chatInput };
                setChatHistory(prev => [...prev, userMsg]);
                setChatInput(''); setLoading(true);
                try {
                    const apiContents = [...chatHistory, userMsg].map(msg => ({ role: msg.role === 'user' ? 'user' : 'model', parts: [{ text: msg.text }] }));
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: apiContents })
                    });
                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);
                    setChatHistory(prev => [...prev, { role: 'model', text: data.candidates[0].content.parts[0].text }]);
                } catch (error) { setChatHistory(prev => [...prev, { role: 'model', text: `‚ö†Ô∏è L·ªói: ${error.message}` }]); } 
                finally { setLoading(false); }
            };

            const handleAnalysis = async () => {
                let textToAnalyze = summaryText;
                if (pdfFile) {
                    try { setLoading(true); textToAnalyze = await extractTextFromPDF(pdfFile); } catch (e) { setLoading(false); alert(e.message); return; }
                }
                if (!textToAnalyze) return alert("Ch∆∞a c√≥ n·ªôi dung!");
                generateContent(`Ph√¢n t√≠ch vƒÉn b·∫£n: ${textToAnalyze}. T√≥m t·∫Øt, quy·ªÅn l·ª£i, nghƒ©a v·ª•. D√πng Markdown.`);
            };

            const handleExplain = () => generateContent(`Gi·∫£i th√≠ch thu·∫≠t ng·ªØ BHYT/BHXH: "${term}" ƒë∆°n gi·∫£n nh·∫•t. D√πng Markdown.`);
            
            const handleMedia = () => {
                generateContent(`Vi·∫øt content ${mediaData.type} cho ${mediaData.target}. D√πng Markdown, icon.`);
            };

            const renderMarkdown = (text) => {
                if (!text) return null;
                try { return <div className="markdown-content animate-fade-in" dangerouslySetInnerHTML={{ __html: marked.parse(text) }} />; } 
                catch (e) { return <div className="text-red-500">L·ªói hi·ªÉn th·ªã.</div>; }
            };

            if (!isKeySet) { 
                 return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100">
                        <div className="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 text-center">
                            <h1 className="text-2xl font-extrabold text-blue-800 mb-2">Tr·ª£ L√Ω BHYT 6.9</h1>
                            <input type="password" value={apiKey} onChange={(e) => setApiKey(e.target.value)} placeholder="Nh·∫≠p API Key..." className="w-full border p-3 rounded-xl mb-4 bg-slate-50" />
                            <button onClick={handleSaveKey} disabled={apiKey.length < 5} className="w-full bg-blue-600 text-white p-3 rounded-xl font-bold">K√≠ch Ho·∫°t</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col md:flex-row bg-slate-50 font-sans">
                    {/* Sidebar PC */}
                    <aside className="hidden md:flex w-72 bg-white border-r border-slate-200 flex-col h-screen sticky top-0 z-20 shadow-sm">
                        <div className="p-6 border-b border-slate-100 flex items-center gap-3 text-blue-800 bg-gradient-to-r from-blue-50 to-white">
                            <div className="p-2 bg-blue-100 rounded-lg"><Icons.Shield /></div>
                            <div><h1 className="font-extrabold text-xl">BHYT 6.9</h1><span className="text-xs font-semibold text-blue-600 bg-blue-100 px-2 rounded-full">Pro Calc</span></div>
                        </div>
                        <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                            {[
                                { id: 'calculate', label: 'T√≠nh Ti·ªÅn BHXH', icon: Icons.Calc },
                                { id: 'chatbot', label: 'Tr·ª£ L√Ω ·∫¢o (Chat)', icon: Icons.Chat },
                                { id: 'summary', label: 'Ph√¢n T√≠ch Lu·∫≠t', icon: Icons.FileText }, 
                                { id: 'explain', label: 'Tra C·ª©u Thu·∫≠t Ng·ªØ', icon: Icons.Search }, 
                                { id: 'media', label: 'S√°ng T·∫°o Content', icon: Icons.Send }
                            ].map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} 
                                    className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-sm font-medium transition-all ${activeTab===item.id ? 'bg-blue-600 text-white shadow-md' : 'text-slate-600 hover:bg-slate-50'}`}>
                                    <div className="w-5 h-5"><item.icon/></div>{item.label}
                                </button>
                            ))}
                        </nav>
                    </aside>

                    {/* Header Mobile */}
                    <div className="md:hidden bg-white p-4 border-b flex justify-between items-center sticky top-0 z-50 shadow-sm">
                        <div className="font-bold text-blue-800 flex items-center gap-2"><Icons.Shield /> BHYT 6.9</div>
                    </div>

                    <main className="flex-1 p-4 pb-24 md:p-8 overflow-y-auto h-screen bg-[#f8fafc]">
                        {activeTab === 'chatbot' ? (
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 h-[85vh] flex flex-col overflow-hidden">
                                <div className="p-4 border-b flex items-center gap-3"><div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600"><Icons.Robot /></div><h3 className="font-bold text-slate-800">Tr·ª£ L√Ω AI</h3></div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50" ref={chatContainerRef}>
                                    {chatHistory.map((msg, i) => (
                                        <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`max-w-[85%] p-3.5 rounded-2xl text-sm shadow-sm ${msg.role==='user' ? 'bg-blue-600 text-white' : 'bg-white text-slate-800 border'}`}>{msg.role==='user' ? msg.text : renderMarkdown(msg.text)}</div>
                                        </div>
                                    ))}
                                    {loading && <div className="text-xs text-slate-500 italic ml-4">AI ƒëang nh·∫≠p...</div>}
                                </div>
                                <div className="p-4 border-t flex gap-3"><input value={chatInput} onChange={e=>setChatInput(e.target.value)} className="flex-1 bg-slate-100 p-3 rounded-xl outline-none" placeholder="Nh·∫≠p c√¢u h·ªèi..." onKeyDown={e=>e.key==='Enter'&&sendChat()}/><button onClick={sendChat} className="bg-blue-600 text-white p-3 rounded-xl"><Icons.Send /></button></div>
                            </div>
                        ) : activeTab === 'calculate' ? (
                            <div className="max-w-4xl mx-auto space-y-6">
                                <BHXHCalculator />
                                <div className="bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm text-blue-800">
                                    <strong>üí° G·ª£i √Ω AI:</strong> B·∫°n c√≥ th·ªÉ d√πng tab "Tr·ª£ L√Ω ·∫¢o" ƒë·ªÉ h·ªèi th√™m v·ªÅ quy·ªÅn l·ª£i khi tham gia 5 nƒÉm li√™n t·ª•c ho·∫∑c ch·∫ø ƒë·ªô t·ª≠ tu·∫•t.
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6 max-w-4xl mx-auto">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                    <h2 className="font-bold text-xl text-slate-800 mb-5 pb-3 border-b">{activeTab === 'summary' ? 'Ph√¢n T√≠ch VƒÉn B·∫£n' : activeTab === 'explain' ? 'Tra C·ª©u Thu·∫≠t Ng·ªØ' : 'S√°ng T·∫°o Content'}</h2>
                                    {activeTab === 'summary' && (
                                        <div className="space-y-4">
                                            <div className="border-2 border-dashed border-slate-300 rounded-xl p-6 text-center"><input type="file" accept=".pdf" onChange={(e) => {setPdfFile(e.target.files[0]); setSummaryText('')}} className="hidden" id="pdf-upload" /><label htmlFor="pdf-upload" className="cursor-pointer text-blue-600 font-bold hover:underline">{pdfFile ? pdfFile.name : "T·∫£i file PDF lu·∫≠t l√™n ƒë√¢y"}</label></div>
                                            <textarea className="w-full border p-4 rounded-xl h-40 outline-none" placeholder="Ho·∫∑c d√°n n·ªôi dung..." value={summaryText} onChange={e=>setSummaryText(e.target.value)} disabled={!!pdfFile}></textarea>
                                            <button onClick={handleAnalysis} disabled={loading} className="w-full bg-blue-600 text-white p-4 rounded-xl font-bold">{loading ? 'ƒêang x·ª≠ l√Ω...' : 'Ph√¢n T√≠ch Ngay'}</button>
                                        </div>
                                    )}
                                    {activeTab === 'explain' && (
                                        <div className="flex gap-3"><input className="flex-1 border p-4 rounded-xl outline-none" placeholder="Nh·∫≠p thu·∫≠t ng·ªØ..." value={term} onChange={e=>setTerm(e.target.value)} /><button onClick={handleExplain} className="bg-purple-600 text-white px-6 rounded-xl font-bold">Tra c·ª©u</button></div>
                                    )}
                                    {activeTab === 'media' && (
                                        <div className="space-y-4">
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="text-xs font-bold block mb-1">ƒê·ªëi t∆∞·ª£ng</label><select className="w-full border p-3 rounded-xl" value={mediaData.target} onChange={e=>setMediaData({...mediaData, target:e.target.value})}><option>Sinh vi√™n</option><option>Lao ƒë·ªông t·ª± do</option><option>Ti·ªÉu th∆∞∆°ng</option></select></div>
                                                <div><label className="text-xs font-bold block mb-1">Ch·ªß ƒë·ªÅ</label><select className="w-full border p-3 rounded-xl" value={mediaData.type} onChange={e=>setMediaData({...mediaData, type:e.target.value})}><option>BHYT H·ªô gia ƒë√¨nh</option><option>BHXH T·ª± nguy·ªán</option></select></div>
                                            </div>
                                            <button onClick={handleMedia} className="w-full bg-pink-600 text-white p-4 rounded-xl font-bold">Vi·∫øt Content</button>
                                        </div>
                                    )}
                                    {result && <div className="mt-6 pt-4 border-t animate-fade-in">{renderMarkdown(result)}</div>}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav Mobile */}
                    <div className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 z-50">
                        {[ { id: 'calculate', icon: Icons.Calc }, { id: 'chatbot', icon: Icons.Chat }, { id: 'summary', icon: Icons.FileText }, { id: 'explain', icon: Icons.Search }, { id: 'media', icon: Icons.Send } ].map(item => (
                            <button key={item.id} onClick={() => setActiveTab(item.id)} className={`p-3 rounded-xl ${activeTab===item.id ? 'text-blue-600 bg-blue-50' : 'text-slate-400'}`}><item.icon /></button>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
